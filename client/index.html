<!doctype html>
<html lang="en">
<head>
  <title>Election Buzz</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> -->
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
  <script src="js/d3.legend.js"></script>
  <link rel='stylesheet' href='css/styles.css'>
  <link rel='stylesheet' text='text/css' href='css/individualCandidate.css'>

  <style>


  </style>
</head>
<body>
  <nav class="navbar navbar-inverse" id='navbar'>
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">
        </a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav">
          <li><a href='#home'>BEE LOGO </a></li>
          <li><a href="#home">Home</a></li>
          <li><a href="#timeline">Tweet Timeline</a></li>
          <li><a href="#Hillary">Clinton</a></li>
          <li><a href="#Sanders">Sanders</a></li>
          <li><a href="#Trump">Trump</a></li>
          <li><a href="aboutus.html">About</a></li>
        </ul>
      </div>
    </div>
  </nav>

<a name='home'>
<div class="container-fluid text-center candidate_block">
  <div class="row content">
    <div class="col-sm-2" >
    </div>
    <div class="col-sm-8 text-center">
      <div class='logo_img'>
      </div>
      <!-- <img src='images/logo.png'> -->
      <div class='tagline'> Looking beyond 140 characters </div>
      <div class='guide_text'> Everyone is tweeting about the election, but what are they saying?</div>
      <div class='action_text'> We compiled a list of some of the most important election topics. Select one to see how much the candidates and their followers mention it on Twitter: </div>
      <select name="Theme" class="selectForm">
  			<option value="Education">Education</option>
  			<option value="Security">Security</option>
  			<option value="Immigration">Immigration</option>
  			<option value="Women">Women</option>
  			<option value="Healthcare">Healthcare</option>
  			<option value="Supreme Court">Supreme Court</option>
  			<option value="Tax">Taxes</option>
  		</select>
  		<div id='title_graph'>
  		  <div class='row'>
  		    <div class="col-sm-6">
  		        <h3>Followers</h3>
  		    </div>
  		    <div class="col-sm-6">
  		        <h3>Candidates </h3>
  		    </div>
  		  </div>
  		</div>

      <div id="graph" class="row">
        <div class= "col-sm-5" id="candidatetweets">
          <div id="fChart"></div>
        </div>
         <div class= "col-sm-2" id="pictures">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr>
                  <div class='candidatePicture'>
                  <a href="#Hillary">
                  <img src='images/hillary.jpg' class='img-circle candidateImg'>
                  @HillaryClinton
                  </a>
                  </div>
              </tr>
              <tr>
                  <div class='candidatePicture'>
                  <a href="#Sanders">
                  <img src='images/bernie.jpg' class='img-circle candidateImg'>
                  @BernieSanders
                  </a>
                  </div>
              </tr>
               <tr>
                   <div class='candidatePicture'>
                   <a href="#Trump">
                  <img src='images/trump.jpg' class='img-circle candidateImg'>
                  @realDonaldTrump
                    </a>
                    </div>
              </tr>
            </tbody>

          </table>
        </div>
         <div class= "col-sm-5" id="followertweets">
          <div id="chart"></div>
        </div>
      </div>

      <br>
      <div class='row'>
        <div class='col-sm-12'>
          <div class='feature_text'> The graphs include the past 3000 tweets by candidates and xxx tweets by candidate's followers. The topics are generated using keywords shown below </div>
          <div class='feature_text'> Education includes: college, tuition, student debt, loans, education, etc...</div>
        </div>
      </div>
      <br>
      <br>

      </div>

    </div>
  </div>
</a>

  <a name='Hillary'>
  <div class="container-fluid text-center light_gray candidate_block">
      <div class="row content">
        <div class='col-sm-2'></div>
        <div class='col-sm-8'>

                  <div class='results'>
                      <img src='images/hillary.jpg' class='img-circle candidateProfileImg'>
                  </div>
              <div class='candidateName'>Hillary Clinton</div>
              <div class='row'>
                <h3>Top Twitter Followers:</h3>
                <div id="loading_Clinton">
                    <img id="loading-image_Clinton" src="images/spin.svg" alt="Loading..." />
                </div>
              </div>
              <div class='row' id="TwitterFollowers_Clinton">
                <div class="row" id='followerProfiles_Clinton'>
                </div>
              </div>
              <!-- <div class="container"> -->
              <div class='row'>
                <div class='guide_text'> We looked at a random sample of Clinton's followers. </div>
                <div class='guide_text'> Choose a day to see what was trending. </div>
              </div>
              <div class='row pick_date'>
                 Choose a day: <input type="text" id="datepicker_Clinton">
              </div>

              <div class='gallery'>
                <img src='#' id='galleryImg_Clinton' class='galleryImg'></img>
              </div>
          </div>
          </div>
      </div>
      <script type='text/javascript' src='js/Hillary.js'></script>
    </a>

    <a name='Sanders'>
      <div class="container-fluid text-center dark_gray candidate_block">
          <div class="row content">
            <div class='col-sm-2'></div>
            <div class='col-sm-8'>

                      <div class='results'>
                          <img src='images/bernie.jpg' class='img-circle candidateProfileImg'>
                      </div>
                  <div class='candidateName'>Bernie Sanders</div>
                  <div class='row'>
                    <h3>Top Twitter Followers:</h3>
                    <div id="loading_Sanders">
                        <img id="loading-image_Sanders" src="images/spin.svg" alt="Loading..." />
                    </div>
                  </div>
                  <div class='row' id="TwitterFollowers_Sanders">
                    <div class="row" id='followerProfiles_Sanders'>
                    </div>
                  </div>
                  <!-- <div class="container"> -->
                  <div class='row'>
                    <div class='guide_text'> We looked at a random sample of Sanders' followers. </div>
                    <div class='guide_text'> Choose a day to see what was trending. </div>
                  </div>
                  <div class='row pick_date'>
                     Choose a day: <input type="text" id="datepicker_Sanders">
                  </div>

                  <div class='gallery'>
                    <img src='#' id='galleryImg_Sanders' class='galleryImg'></img>
                  </div>
              </div>
              </div>
          </div>
          <script type='text/javascript' src='js/Sanders.js'></script>
    </a>

    <a name='Trump'>
      <div class="container-fluid text-center gray candidate_block">
          <div class="row content">
            <div class='col-sm-2'></div>
            <div class='col-sm-8'>

                      <div class='results'>
                          <img src='images/trump.jpg' class='img-circle candidateProfileImg'>
                      </div>
                  <div class='candidateName'>Donald Trump</div>
                  <div class='row'>
                    <h3>Top Twitter Followers:</h3>
                    <div id="loading_Trump">
                        <img id="loading-image_Trump" src="images/spin.svg" alt="Loading..." />
                    </div>
                  </div>
                  <div class='row' id="TwitterFollowers_Trump">
                    <div class="row" id='followerProfiles_Trump'>
                    </div>
                  </div>
                  <!-- <div class="container"> -->
                  <div class='row'>
                    <div class='guide_text'> We looked at a random sample of Trump's followers. </div>
                    <div class='guide_text'> Choose a day to see what was trending. </div>
                  </div>
                  <div class='row pick_date'>
                     Choose a day: <input type="text" id="datepicker_Trump">
                  </div>

                  <div class='gallery'>
                    <img src='#' id='galleryImg_Trump' class='galleryImg'></img>
                  </div>
              </div>
              </div>
          </div>
          <script type='text/javascript' src='js/Trump.js'></script>
    </a>

    <a name='timeline'>
      <!-- <script type='text/javascript' src='js/timeline.js'></script> -->

      <div class="container-fluid text-center">
          <div class='row'>
              <div class='guide_text'>Now it's your turn! Search any word and you will discover how much each candidate's followers mentioned it.</div>
                    <input type="text" name="word" id='word'>
                    <button onclick='updateChart()' class="btn btn-primary">Search!</button>
                      <div id='graph_timeline'></div>
                  </div>
                <div class='feature_text'>How does this work? We used a random sample of the last 3000 tweets of 1000 followers for each candidate, attempting to filter out journalists, twitter bots, and influential people </div>
          </div>
    </a>






</body>

	<script type="text/javascript">

  var word = "";

  function filterTrump(obj) {
      return obj.support === "realDonaldTrump";
  }

  function filterClinton(obj) {
      return obj.support === "HillaryClinton";
  }

  function filterSanders(obj) {
      return obj.support === "BernieSanders";
  }
  function filterDate(obj){
    return obj.Date > parseDate('2016/00');
  }

  var allData = null;
  function updateChart(){
    var input=$('#word').val();
    url = 'http://162.243.13.220:8081/api/timeline?word='+input;
    console.log(url)
    // return;
    $.getJSON(url,function(data){
      data.forEach(function(d) {
          // if ()(d.Date.length)==6)
          // console.log(d.Date.length);
          if (d.Date.length == 6){
            d.Date  = d.Date.substr(0,5)+'0'+d.Date.substr(5,1);//+'/0';
          }
          else{
            d.Date = d.Date;//+'/0';
          }
          // console.log(d.Date);
          // console.log(d.Date+'-'+parseDate(d.Date));
          d.Date = parseDate(d.Date);
          // console.log(d.Date);
      });
      data = data.filter(filterDate);
      data = data.sort(function(a,b){
        return +a.Date - b.Date;
      });
      allData = data;
      var trumpData = data.filter(filterTrump);
      var clintonData = data.filter(filterClinton);
      var sandersData = data.filter(filterSanders);
      // console.table(data);

      x.domain(d3.extent(data, function(d) { return d.Date;}));
      y.domain(d3.extent(data, function(d) {return d.Ct; }));


      svg_timeline.select ('.x.axis')
        .call(xAxis);

      svg_timeline.select('.y.axis')
        .call(yAxis);

      svg_timeline.select('.x.grid')
        .attr("transform", "translate(0," + height + ")")
        .call(make_x_axis()
            .tickSize(-height, 0, 0)
            .tickFormat("")
        );

      svg_timeline.select('.y.grid')
      .call(make_y_axis()
          .tickSize(-width, 0, 0)
          .tickFormat("")
      )


      allDots = svg_timeline.selectAll('circle')
          .data(allData);

      allDots.enter()
          .append('circle');

      allDots.exit().remove();

      allDots.transition()
          .attr('cx',function(d) { return x(d.Date); })
          .attr('cy',function(d) { return y(d.Ct);})
          .attr('r','3px')
          .attr("stroke",function(d){
            // console.log('hihi');
            if (d.support === 'HillaryClinton')
            {
              return 'blue';
            }
            if (d.support === 'BernieSanders')
            {
              return 'green';
            }
            if (d.support === 'realDonaldTrump')
            {
              return 'red';
            }
          })
          .attr('data-legend',function(d){ return d.support;})
          .attr("fill",function(d){
            console.log('hihi');
            if (d.support === 'HillaryClinton')
            {
              return 'blue';
            }
            if (d.support === 'BernieSanders')
            {
              return 'green';
            }
            if (d.support === 'realDonaldTrump')
            {
              return 'red';
            }
          });

          legend.attr("transform","translate(50,30)")
          .style("font-size","15px")
          .call(d3.legend);
      });
      return;
  }

  var margin = {top: 20, right: 80, bottom: 30, left: 50},
  width = 900 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;

  var parseDate = d3.time.format("%Y/%U").parse;

  var x = d3.time.scale()
      .range([0, width]);

  var y = d3.scale.linear()
      .range([height, 0]);

  var color = d3.scale.category10();
  var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom")
      .ticks(8);


  var yAxis = d3.svg.axis()
      .scale(y)
      .orient("left")
      .ticks(5);

  function make_x_axis() {
      return d3.svg.axis()
          .scale(x)
           .orient("bottom")
           .ticks(10)
  };

  function make_y_axis() {
      return d3.svg.axis()
          .scale(y)
          .orient("left")
          .ticks(10)
  };

  var line = d3.svg.line()
      // .interpolate("basis")
      .x(function(d) {
          console.log(d.Date+'-'+x(d.Date));
          return x(d.Date); })
      .y(function(d) {
        console.log(d.Date+'-'+y(d.Date));
        return y(d.Ct); });

  var svg_timeline = d3.select("#graph_timeline").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


  var trumpLine = null;
  var clintonLine = null;
  var sandersLine = null;
  var allDots = null;
  var xAxes = null;
  var yAxes = null;
  var yGrid = null;
  var xGrid = null;
  var legend = null;


  var url = 'http://162.243.13.220:8081/api/timeline?word=women'
  $('#word').val('women');
  $.getJSON(url,function(data){

    // console.table(data);
      data.forEach(function(d) {
          // if ()(d.Date.length)==6)
          // console.log(d.Date.length);
          if (d.Date.length == 6){
            d.Date  = d.Date.substr(0,5)+'0'+d.Date.substr(5,1);//+'/0';
          }
          else{
            d.Date = d.Date;//+'/0';
          }
          // console.log(d.Date);
          // console.log(d.Date+'-'+parseDate(d.Date));
          d.Date = parseDate(d.Date);
          // console.log(d.Date);
      });
      data = data.filter(filterDate);
      data = data.sort(function(a,b){
        return +a.Date - b.Date;
      });
      allData = data;
      var trumpData = data.filter(filterTrump);
      var clintonData = data.filter(filterClinton);
      var sandersData = data.filter(filterSanders);

      // console.table(trumpData);
      x.domain(d3.extent(data, function(d) { return d.Date;}));
      y.domain(d3.extent(data, function(d) {return d.Ct; }));

      xAxes = svg_timeline.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

      yAxes = svg_timeline.append("g")
      .attr("class", "y axis")
      .call(yAxis)
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")

      yGrid = svg_timeline.append("g")
      .attr("class", "y grid")
      .call(make_y_axis()
          .tickSize(-width, 0, 0)
          .tickFormat("")
      )

      xGrid = svg_timeline.append("g")
      .attr("class", "x grid")
      .attr("transform", "translate(0," + height + ")")
      .call(make_x_axis()
          .tickSize(-height, 0, 0)
          .tickFormat("")
      );
      // .text("Price ($)");

      allDots = svg_timeline.selectAll('circle')
          .data(data)
          .enter()
          .append('circle')
          .attr('cx',function(d) { return x(d.Date); })
          .attr('cy',function(d) { return y(d.Ct);})
          .attr('r','3px')
          .attr("stroke",function(d){
            console.log('hihi');
            if (d.support === 'HillaryClinton')
            {
              return 'blue';
            }
            if (d.support === 'BernieSanders')
            {
              return 'green';
            }
            if (d.support === 'realDonaldTrump')
            {
              return 'red';
            }
          })
          .attr('data-legend',function(d){ return d.support;})
          .attr("fill",function(d){
            console.log('hihi');
            if (d.support === 'HillaryClinton')
            {
              return 'blue';
            }
            if (d.support === 'BernieSanders')
            {
              return 'green';
            }
            if (d.support === 'realDonaldTrump')
            {
              return 'red';
            }
          });

     legend = svg_timeline.append("g")
            .attr("class","legend")
            .attr("transform","translate(50,30)")
            .style("font-size","15px")
            .call(d3.legend);

      // trumpLine = svg_timeline.append('path')
      //     .datum(trumpData)
      //     .attr('class','line')
      //     .attr('d',line)
      //     .style('stroke','red');
      //
      // clintonLine = svg_timeline_timeline.append('path')
      //     .datum(clintonData)
      //     .attr('class','line')
      //     .attr('d',line)
      //     .style('stroke','blue');
      //
      // sandersLine = svg_timeline.append('path')
      //     .datum(sandersData)
      //     .attr('class','line')
      //     .attr('d',line)
      //     .style('stroke','green');




  });


  $(function() {
  $('a[href*="#"]:not([href="#"])').click(function() {
    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
      if (target.length) {
        $('html, body').animate({
          scrollTop: target.offset().top
        }, 1000);
        return false;
      }
    }
  });
});

		var theme = "Education";
		function rightTheme(obj){
			return obj.Topic == theme;
		}

		var w =  $('#followertweets').width();
		var   h = $('#followertweets').height();

		var svg = d3.select("#chart")
			.append("svg")
			.attr("class",'candidatechart')
			.attr("width", w)
			.attr("height", h);
		var max_n = 10;

		d3.json("../tweet_analysis_py/tweetdata.json", function(json) {

			var data = json.Themes.filter(rightTheme);

			var data = data[0].Data;
			for (var d in data) {
				console.log(d);
				max_n = Math.max(data[d].Tweets, max_n);
				// console.log(data.Data[d]);
			}
			console.log(max_n);
			// debugger;

			var dx = w / max_n;
			var dy = h / data.length;



			// bars

			var bars = svg.selectAll(".bar")
				.data(data)
				.enter()
				.append("rect")
				.attr("class", function(d, i) {return "bar " + d.Name;})
				.attr("x", function(d, i) {return 0;})
				.attr("y", function(d, i) {return dy*i;})
				.attr("width", function(d, i) {return dx*d.Tweets})
				.attr("height", dy*.95)
				.attr("rx",2)
				.attr("ry",2);

			// labels
			var text = svg.selectAll("text")
				.data(data)
				.enter()
				.append("text")
				.attr("class", function(d, i) {return "label " + d.Name;})
				.attr("x", function(d,i) { return dx*d.Tweets+5})
				.attr("y", function(d, i) {return dy*i + dy/2;})
				.text( function(d) {return Number(d.Tweets).toFixed(1)  + "% ("+d.Number+" tweets)";})
				.style("font-weight", "bold");
		});


		$('select').on('change', function(){
			console.log("Theme changed to: ",this.value);
			theme = this.value;
			d3.json("../tweet_analysis_py/tweetdata.json",function(json){

				var data = json.Themes.filter(rightTheme);

				var data = data[0].Data;
				for (var d in data) {
					console.log(d);
					max_n = Math.max(data[d].Tweets, max_n);
					// console.log(data.Data[d]);
				}
				console.log(max_n);
				// debugger;

				var dx = w / max_n;
				var dy = h / data.length;

				svg.selectAll(".bar")
					.data(data)
					.transition()
					.attr("width", function(d, i) {return dx*d.Tweets});

				svg.selectAll("text")
					.data(data)
					.transition()
					.attr("x", function(d,i) { return dx*d.Tweets+5})
					.text( function(d) {return Number(d.Tweets).toFixed(1)  + "% ("+d.Number+" tweets)";});
			});
		});


		///////////////////////////////////////////////////////////////
		/////////////////////////// FOLLOWERS /////////////////////////


		var w1 =  $('#candidatetweets').width();
		var h1 = $('#candidatetweets').height();

		var svg1 = d3.select("#fChart")
			.append("svg")
			.attr("class",'followerChart')
			.attr("width", w)
			.attr("height", h);
		var max_n1 = 10;

		d3.json("../tweet_analysis_py/tweetdata_followers.json", function(json) {

			var data = json.Themes.filter(rightTheme);

			var data = data[0].Data;
			for (var d in data) {
				// console.log(d);
				max_n = Math.max(data[d].Tweets, max_n);
				// console.log(data.Data[d]);
			}
		// 	console.log(max_n);
			// debugger;

			var dx = w1 / max_n1;
			var dy = h1 / data.length;

			// bars
			var randNumbers = [(Math.random() * 8),(Math.random() * 8),(Math.random() * 8)]
      console.log(randNumbers);
			var bars = svg1.selectAll(".bar")
				.data(data)
				.enter()
				.append("rect")
				.attr("class", function(d, i) {return "bar " + d.Name;})
				.attr("x", function(d, i) {return w1-dx*randNumbers[i];})
				.attr("y", function(d, i) {return dy*i;})
				.attr("width", function(d, i) {return dx*randNumbers[i]})
				.attr("height", dy*.95)
				.attr("rx",2)
				.attr("ry",2);

			// labels
			var text = svg1.selectAll("text")
				.data(data)
				.enter()
				.append("text")
				.attr("class", function(d, i) {return "label " + d.Name;})
				.attr("x", function(d,i) { return w1-dx*randNumbers[i]-40})
				.attr("y", function(d, i) {return dy*i + dy/2;})
				.text( function(d,i) {return Number(randNumbers[i]).toFixed(1)  + "%";})
				.style("font-weight", "bold");
		});

		$('select').on('change', function(){
			theme = this.value;
			d3.json("../tweet_analysis_py/tweetdata_followers.json",function(json,error){
        if (error) return console.warn(error);

				var data = json.Themes.filter(rightTheme);

				var data = data[0].Data;
				for (var d in data) {
					console.log(d);
					max_n1 = Math.max(data[d].Tweets, max_n);
					// console.log(data.Data[d]);
				}
				console.log(max_n1);
				// debugger;

			  var randNumbers = [(Math.random() * 8),(Math.random() * 8),(Math.random() * 8)]
				var dx = w1 / max_n1;
				var dy = h1 / data.length;

				svg1.selectAll(".bar")
					.data(data)
					.transition()
					.attr("x",function(d,i) { return w1-dx*randNumbers[i]})
					.attr("width", function(d, i) {return dx*randNumbers[i]});

				svg1.selectAll("text")
					.data(data)
					.transition()
					.attr("x", function(d,i) { return w1-dx*randNumbers[i]-40})
					.text( function(d, i) {return Number(randNumbers[i]).toFixed(1)  + "%";});
			});
		});
	</script>
</html>
